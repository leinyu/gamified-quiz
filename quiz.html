<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quiz App — All in One</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f1724; --card:rgba(255,255,255,0.03);
  --muted:#9aa0b4; --accent1:#5b5fff; --accent2:#ff6f91;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial;
  background:linear-gradient(135deg,#0b1220,#0f1724);
  color:#e6eef8;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:28px;
}

.app {
  width:100%;
  max-width:920px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:20px;
  box-shadow:0 12px 40px rgba(2,6,23,0.6);
  margin-bottom:18px;
}

.center {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:48px 28px;
}
h1 { margin:0 0 18px; font-size:28px; font-weight:700; color:#fff; }

.input{
  width:320px; max-width:92%;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  background:rgba(255,255,255,0.02);
  color: #fff;
  font-size:15px;
  margin-top:12px;
}
.btn{
  padding:10px 16px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:700;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  color:#ffffff;
  margin-top:14px;
  box-shadow:0 8px 18px rgba(91,91,255,0.12);
}
.btn.secondary{ background:rgba(255,255,255,0.06); color:#fff; font-weight:600; }
.btn.warn{ background:#ff5b5b; color:#fff; }

.settings-toggle{
  position:fixed; top:20px; right:20px;
  width:52px; height:52px; border-radius:12px; border:none;
  background:linear-gradient(90deg,var(--accent1),#3aa0ff);
  color:#fff; font-size:20px; cursor:pointer; z-index:2000;
  box-shadow:0 10px 30px rgba(41,57,255,0.12);
}

.settings-panel{
  position:fixed; top:88px; right:20px; z-index:2000;
  background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.03));
  border-radius:12px; padding:16px; width:300px; display:none;
  box-shadow:0 20px 50px rgba(0,0,0,0.6);
}
.settings-panel h3{ margin:0 0 12px; color:#fff; font-size:18px }
.setting-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin:10px 0; }
.setting-row label{ color:var(--muted); font-weight:600; font-size:14px; }
.select, .input-sm{ padding:8px 10px; border-radius:8px; background:rgba(0,0,0,0.35); color:#fff; border:1px solid rgba(255,255,255,0.04); }

.page{ display:none; }
.page.active{ display:block; }

.progress-bar{ height:12px; background:rgba(255,255,255,0.04); border-radius:999px; overflow:hidden; margin:10px 0 16px; }
.progress-fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent1),var(--accent2)); transition:width 400ms ease; }

.q-card{ background:rgba(255,255,255,0.02); padding:18px; border-radius:12px; margin-bottom:12px; border:1px solid rgba(255,255,255,0.02); }
.q-title{ font-weight:700; margin-bottom:10px; font-size:18px; color:#fff }
.options{ display:flex; flex-direction:column; gap:8px; }
.option{
  padding:10px 12px; border-radius:10px; cursor:pointer; display:flex; align-items:center; gap:10px;
  background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03);
}
.option input{ transform:scale(1.05); margin-right:6px }
.option:hover{ transform: translateY(-3px); box-shadow:0 10px 30px rgba(0,0,0,0.4) }

.result-row{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin:6px 0; }

.admin-grid{ display:flex; gap:14px; flex-wrap:wrap; }
.admin-left{ flex:2; min-width:280px }
.admin-right{ flex:1; min-width:220px }

.admin-q{ background:rgba(255,255,255,0.02); padding:12px; border-radius:10px; margin-bottom:10px; border:1px solid rgba(255,255,255,0.03); }
.admin-q .row{ display:flex; gap:8px; margin-top:8px; }
.small{ font-size:13px; color:var(--muted) }
hr{ border:none; border-top:1px solid rgba(255,255,255,0.03); margin:12px 0 }

body.theme-cartoon{ background:linear-gradient(135deg,#fff2b8,#ffd07a); color:#111 }
body.theme-christmas{ background:linear-gradient(135deg,#8bd3dd,#5dd6a6); color:#04251a }
body.theme-horror{ background:linear-gradient(135deg,#2b1b3a,#6b1b2a); color:#fff }
body.theme-sci-fi{ background:linear-gradient(135deg,#071829,#0f2a44); color:#8df7ff }

@media (max-width:760px){
  .admin-grid{ flex-direction:column }
  .settings-panel{ right:12px; left:12px; width:auto }
}
</style>
</head>
<body>
  <button class="settings-toggle" id="settingsToggle" title="Settings">⚙️</button>

  <div class="settings-panel" id="settingsPanel" aria-hidden="true">
    <h3>Settings</h3>

    <div class="setting-row">
      <label for="soundToggle">Sound Effects</label>
      <input id="soundToggle" type="checkbox">
    </div>

    <div class="setting-row">
      <label for="themeSelect">Theme</label>
      <select id="themeSelect" class="select">
        <option value="default">Default</option>
        <option value="cartoon">Cartoon (Toy Story)</option>
        <option value="christmas">Christmas</option>
        <option value="horror">Horror</option>
        <option value="sci-fi">Sci-Fi</option>
      </select>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px">
      <button class="btn" id="saveSettingsBtn">Save</button>
      <button class="btn secondary" id="closeSettingsBtn">Close</button>
    </div>

    <div style="margin-top:12px; text-align:center">
      <button class="btn secondary" id="openAdminFromSettings">Admin</button>
    </div>
  </div>

  <main class="app" id="app">
    <!-- START PAGE -->
    <section id="page-home" class="page active">
      <div class="card center">
        <h1>Welcome to the Quiz</h1>
        <input id="inputName" class="input" placeholder="Enter your name" />
        <button class="btn" id="startBtn">Start</button>
      </div>
    </section>

    <section id="page-quiz" class="page">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div>
            <div class="small">Student:</div>
            <div style="font-weight:700" id="studentLabel"></div>
          </div>
          <div style="text-align:right">
            <div class="small">Progress</div>
            <div id="progressText" class="small"></div>
          </div>
        </div>

        <div class="progress-bar" aria-hidden="true">
          <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="q-card" id="questionBox">
          <div class="q-title" id="qTitle">Question will appear here</div>
          <div class="options" id="qOptions"></div>
        </div>

        <div style="display:flex;gap:10px;justify-content:flex-end">
          <button class="btn secondary" id="prevBtn">Previous</button>
          <button class="btn" id="nextBtn">Next</button>
        </div>
      </div>
    </section>

    <section id="page-results" class="page">
      <div class="card">
        <h2>Results</h2>
        <div class="result-row"><div id="resultsScore"></div><div id="resultsDetails" class="small"></div></div>
        <hr/>
        <div id="answersList"></div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" id="homeBtn">Home</button>
        </div>
      </div>
    </section>

    <section id="page-admin" class="page">
      <div class="card" id="adminLoginCard">
        <h2>Admin Login</h2>
        <div style="max-width:480px;margin:0 auto">
          <input id="adminUser" class="input" placeholder="Username" />
          <input id="adminPass" class="input" placeholder="Password" type="password" />
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
            <button class="btn" id="adminLoginBtn">Login</button>
            <button class="btn secondary" id="adminCancelBtn">Cancel</button>
          </div>
          <div class="small" style="margin-top:10px;color:var(--muted)">Admin credentials: <strong>admin</strong> / <strong>secure123</strong></div>
        </div>
      </div>

      <div class="card" id="adminPanelCard" style="display:none">
        <h2>Admin Panel</h2>

        <div class="admin-grid">
          <div class="admin-left">
            <h3>Questions</h3>
            <div id="adminQuestions"></div>

            <h3 style="margin-top:12px">Add question</h3>
            <div style="display:flex;flex-direction:column;gap:8px">
              <input id="addCat" class="input" placeholder="Category (e.g. Programming)">
              <input id="addQ" class="input" placeholder="Question text">
              <input id="addA" class="input" placeholder="Option A">
              <input id="addB" class="input" placeholder="Option B">
              <input id="addC" class="input" placeholder="Option C">
              <input id="addD" class="input" placeholder="Option D">
              <div style="display:flex;gap:8px;align-items:center">
                <label class="small" style="margin-right:6px">Correct:</label>
                <select id="addCorrect" class="select">
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="D">D</option>
                </select>
              </div>
              <div style="display:flex;gap:8px;justify-content:flex-end">
                <button class="btn" id="addQBtn">Add</button>
                <button class="btn secondary" id="reloadQBtn">Refresh</button>
              </div>
            </div>
          </div>

          <div class="admin-right">
            <h3>Students</h3>
            <div id="adminStudents" class="small"></div>
            <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
              <button class="btn warn" id="resetStudentsBtn">Reset Scores (wipe students)</button>
              <button class="btn secondary" id="exportBtn">Export Students (JSON)</button>
              <button class="btn" id="logoutAdminBtn">Logout</button>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

<script>
const KEY_Q = 'quiz_questions_v2';
const KEY_S = 'quiz_students_v2';
const KEY_THEME = 'quiz_theme_v2';
const KEY_SOUND = 'quiz_sound_v2';

const defaultQuestions = [
  { id: 1, category:'Programming', q:'What is a programming language?', A:'A type of computer hardware', B:'A way to communicate with a computer using code', C:'A social media app', D:'A computer virus', correct:'B' },
  { id: 2, category:'Programming', q:'Which of the following is a programming language?', A:'HTML', B:'Python', C:'Google', D:'Excel', correct:'B' },
  { id: 3, category:'General', q:'What is the main purpose of writing a program?', A:'To decorate a website', B:'To make the computer perform tasks', C:'To play music', D:'To design posters', correct:'B' },
  { id: 4, category:'General', q:'In programming, what is a variable?', A:'A type of food', B:'A storage location for data', C:'A computer virus', D:'A network device', correct:'B' },
  { id: 5, category:'General', q:"What does 'print' do in most programming languages?", A:'Sends data to a printer', B:'Displays output on the screen', C:'Shuts down the computer', D:'Deletes data', correct:'B' }
];

let questions = load(KEY_Q, defaultQuestions);
let students = load(KEY_S, []);
let currentIndex = 0;
let currentStudent = '';
let answers = [];

function load(key, fallback){
  try{
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(fallback));
  }catch(e){ return JSON.parse(JSON.stringify(fallback)); }
}
function save(key, value){ localStorage.setItem(key, JSON.stringify(value)); }

function esc(s){ return (s==null)?'':String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

const pages = {
  home: document.getElementById('page-home'),
  quiz: document.getElementById('page-quiz'),
  results: document.getElementById('page-results'),
  admin: document.getElementById('page-admin')
};
function showPage(name){
  Object.values(pages).forEach(p=>p.classList.remove('active'));
  if(pages[name]) pages[name].classList.add('active');
}

const settingsToggle = document.getElementById('settingsToggle');
const settingsPanel = document.getElementById('settingsPanel');
const saveSettingsBtn = document.getElementById('saveSettingsBtn');
const closeSettingsBtn = document.getElementById('closeSettingsBtn');
const openAdminFromSettings = document.getElementById('openAdminFromSettings');

settingsToggle.addEventListener('click', ()=> {
  settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
});
closeSettingsBtn.addEventListener('click', ()=> settingsPanel.style.display = 'none');

saveSettingsBtn.addEventListener('click', ()=>{
  const theme = document.getElementById('themeSelect').value || 'default';
  localStorage.setItem(KEY_THEME, theme);
  const sound = document.getElementById('soundToggle').checked;
  localStorage.setItem(KEY_SOUND, JSON.stringify(sound));
  applyTheme(theme);
  settingsPanel.style.display = 'none';
  alert('Settings saved');
});

openAdminFromSettings.addEventListener('click', ()=> {
  settingsPanel.style.display = 'none';
  showPage('admin');
});

applyTheme(localStorage.getItem(KEY_THEME) || 'default');
function applyTheme(t){
  document.body.className = (t && t !== 'default') ? `theme-${t}` : '';
}

document.getElementById('startBtn').addEventListener('click', ()=>{
  const name = document.getElementById('inputName').value.trim();
  if(!name){ alert('Please enter your name'); return; }
  currentStudent = name;
  answers = [];
  currentIndex = 0;
  document.getElementById('studentLabel').textContent = currentStudent;
  showQuestion(currentIndex);
  showPage('quiz');
});

const qTitle = document.getElementById('qTitle');
const qOptions = document.getElementById('qOptions');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');

function showQuestion(index){
  if(questions.length === 0){
    alert('No questions available. Admin must add questions.');
    showPage('home'); return;
  }
  const q = questions[index];
  qTitle.innerHTML = esc((index+1)+'. '+q.q);
  qOptions.innerHTML = '';
  ['A','B','C','D'].forEach(opt=>{
    const label = document.createElement('label');
    label.className = 'option';
    label.innerHTML = `<input type="radio" name="choice" value="${opt}"> <span style="font-weight:600;margin-right:8px">${opt}.</span> ${esc(q[opt])}`;
    qOptions.appendChild(label);
  });

  const chosen = answers[index] || null;
  if(chosen){
    const node = qOptions.querySelector(`input[value="${chosen}"]`);
    if(node) node.checked = true;
  }

  const pct = Math.round(((index)/questions.length)*100);
  progressFill.style.width = `${Math.round(((index+1)/questions.length)*100)}%`;
  progressText.textContent = `${index+1} / ${questions.length}`;

  prevBtn.style.display = (index>0)?'inline-flex':'none';
  nextBtn.textContent = (index === questions.length-1) ? 'Submit' : 'Next';
}

prevBtn.addEventListener('click', ()=>{
  saveCurrentSelection();
  if(currentIndex>0){ currentIndex--; showQuestion(currentIndex); }
});

nextBtn.addEventListener('click', ()=>{
  saveCurrentSelection();
  if(currentIndex < questions.length-1){
    currentIndex++;
    showQuestion(currentIndex);
  } else {
    finishQuiz();
  }
});

function saveCurrentSelection(){
  const sel = qOptions.querySelector('input[name="choice"]:checked');
  const val = sel ? sel.value : null;
  answers[currentIndex] = val;
}

function finishQuiz(){
  saveCurrentSelection();

  let correctCount = 0;
  const detailed = [];
  questions.forEach((q, idx)=>{
    const chosen = answers[idx] || null;
    detailed.push({ q: q.q, chosen: chosen, correct: q.correct });
    if(chosen === q.correct) correctCount++;
  });
  const pct = Math.round((correctCount / questions.length) * 100);

  const existingIndex = students.findIndex(s=>s.name === currentStudent);
  const record = { name: currentStudent, score: pct, correct: correctCount, total: questions.length, date: new Date().toISOString() };
  if(existingIndex >= 0) students[existingIndex] = record; else students.push(record);
  save(KEY_S, students);

  document.getElementById('resultsScore').innerHTML = `<strong>${esc(currentStudent)}</strong> — ${pct}% (${correctCount}/${questions.length})`;
  document.getElementById('resultsDetails').textContent = `Answered: ${answers.filter(a=>a).length} / ${questions.length}`;
  const answersList = document.getElementById('answersList');
  answersList.innerHTML = '';
  detailed.forEach((d, i)=>{
    const div = document.createElement('div');
    div.className = 'admin-q';
    div.innerHTML = `<div style="font-weight:700">${i+1}. ${esc(d.q)}</div>
      <div class="small">Your: ${d.chosen ? d.chosen : '<em>No answer</em>'} | Correct: ${d.correct}</div>`;
    answersList.appendChild(div);
  });

  currentIndex = 0;
  answers = [];
  showPage('results');
}

document.getElementById('homeBtn').addEventListener('click', ()=>{
  showPage('home');
});

const adminLoginBtn = document.getElementById('adminLoginBtn');
const adminCancelBtn = document.getElementById('adminCancelBtn');
const adminPanelCard = document.getElementById('adminPanelCard');
const adminLoginCard = document.getElementById('adminLoginCard');

adminLoginBtn.addEventListener('click', ()=>{
  const user = document.getElementById('adminUser').value.trim();
  const pass = document.getElementById('adminPass').value;
  if(user === 'admin' && pass === 'secure123'){
    adminLoginCard.style.display = 'none';
    adminPanelCard.style.display = 'block';
    renderAdminQuestions();
    renderAdminStudents();
  } else {
    alert('Wrong credentials');
  }
});
adminCancelBtn.addEventListener('click', ()=> showPage('home'));

document.getElementById('logoutAdminBtn').addEventListener('click', ()=>{
  adminLoginCard.style.display = 'block';
  adminPanelCard.style.display = 'none';
  showPage('home');
});

function renderAdminQuestions(){
  const container = document.getElementById('adminQuestions');
  container.innerHTML = '';
  if(questions.length === 0){
    container.innerHTML = '<div class="small">No questions yet</div>';
    return;
  }
  questions.forEach(q=>{
    const node = document.createElement('div');
    node.className = 'admin-q';
    node.innerHTML = `
      <div style="font-weight:700">ID ${q.id} — ${esc(q.category)}</div>
      <div><input class="input" id="inq_${q.id}" value="${esc(q.q)}"></div>
      <div class="row">
        <input class="input" id="ina_${q.id}" value="${esc(q.A)}">
        <input class="input" id="inb_${q.id}" value="${esc(q.B)}">
      </div>
      <div class="row">
        <input class="input" id="inc_${q.id}" value="${esc(q.C)}">
        <input class="input" id="ind_${q.id}" value="${esc(q.D)}">
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
        <select id="incorr_${q.id}" class="select" style="width:90px">
          <option value="A"${q.correct==='A'?' selected':''}>A</option>
          <option value="B"${q.correct==='B'?' selected':''}>B</option>
          <option value="C"${q.correct==='C'?' selected':''}>C</option>
          <option value="D"${q.correct==='D'?' selected':''}>D</option>
        </select>
        <input class="input" id="incat_${q.id}" value="${esc(q.category)}" style="width:140px">
        <button class="btn" onclick="saveAdminQuestion(${q.id})">Save</button>
        <button class="btn warn" onclick="removeQuestion(${q.id})">Remove</button>
      </div>
    `;
    container.appendChild(node);
  });
}

function saveAdminQuestion(id){
  const q = questions.find(x=>x.id===id);
  if(!q) return alert('Not found');
  q.q = document.getElementById(`inq_${id}`).value.trim() || q.q;
  q.A = document.getElementById(`ina_${id}`).value.trim() || q.A;
  q.B = document.getElementById(`inb_${id}`).value.trim() || q.B;
  q.C = document.getElementById(`inc_${id}`).value.trim() || q.C;
  q.D = document.getElementById(`ind_${id}`).value.trim() || q.D;
  q.correct = document.getElementById(`incorr_${id}`).value || q.correct;
  q.category = document.getElementById(`incat_${id}`).value.trim() || q.category;
  save(KEY_Q, questions);
  alert('Saved');
  renderAdminQuestions();
}

function removeQuestion(id){
  if(!confirm('Remove question?')) return;
  questions = questions.filter(q=>q.id!==id);
  save(KEY_Q, questions);
  renderAdminQuestions();
}

document.getElementById('addQBtn').addEventListener('click', ()=>{
  const cat = document.getElementById('addCat').value.trim() || 'General';
  const qtext = document.getElementById('addQ').value.trim();
  const A = document.getElementById('addA').value.trim();
  const B = document.getElementById('addB').value.trim();
  const C = document.getElementById('addC').value.trim();
  const D = document.getElementById('addD').value.trim();
  const correct = document.getElementById('addCorrect').value || 'A';
  if(!qtext || !A || !B || !C || !D){ alert('Fill all fields'); return; }
  const newQ = { id: Date.now(), category: cat, q: qtext, A:A, B:B, C:C, D:D, correct: correct };
  questions.push(newQ);
  save(KEY_Q, questions);
  document.getElementById('addQ').value=''; document.getElementById('addA').value=''; document.getElementById('addB').value=''; document.getElementById('addC').value=''; document.getElementById('addD').value='';
  alert('Question added');
  renderAdminQuestions();
});

function renderAdminStudents(){
  const el = document.getElementById('adminStudents');
  el.innerHTML = '';
  if(students.length === 0){ el.innerHTML = '<div class="small">No student records</div>'; return; }
  const sorted = students.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
  sorted.forEach(s=>{
    const row = document.createElement('div');
    row.style.display = 'flex'; row.style.justifyContent='space-between'; row.style.padding='6px 0';
    row.innerHTML = `<div><strong>${esc(s.name)}</strong> <span class="small">${new Date(s.date).toLocaleString()}</span></div><div>${s.score}%</div>`;
    el.appendChild(row);
  });
}

document.getElementById('reloadQBtn').addEventListener('click', ()=> {
  questions = load(KEY_Q, defaultQuestions);
  renderAdminQuestions();
  alert('Refreshed from localStorage');
});

document.getElementById('resetStudentsBtn').addEventListener('click', ()=>{
  if(!confirm('This will wipe ALL student records (names and scores). Continue?')) return;
  students = [];
  save(KEY_S, students);
  renderAdminStudents();
  alert('Student records cleared');
});

document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = JSON.stringify(students, null, 2);
  const blob = new Blob([data], { type:'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'students.json'; a.click();
  URL.revokeObjectURL(url);
});

function removeQuestionById(id){ removeQuestion(id); }

function renderStudentListOnHome(){}

function init(){
  if(!localStorage.getItem(KEY_Q)) save(KEY_Q, defaultQuestions);
  if(!localStorage.getItem(KEY_S)) save(KEY_S, []);
  questions = load(KEY_Q, defaultQuestions);
  students = load(KEY_S, []);
  applyTheme(localStorage.getItem(KEY_THEME) || 'default');
}
init();

document.getElementById('openAdminFromSettings').addEventListener('click', ()=> {
  settingsPanel.style.display = 'none';
  showPage('admin');
});

document.getElementById('settingsToggle').addEventListener('dblclick', ()=> {
  settingsPanel.style.display = 'block';
});
</script>
</body>
</html>
